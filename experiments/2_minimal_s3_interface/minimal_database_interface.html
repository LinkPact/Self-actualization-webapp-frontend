<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>S3 test</title>

    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.813.0.min.js"></script>
</head>
<body>

<h1>Minimal database interface</h1>

<p>Required content</p>

<ul>
    <li>Add new single-name entries</li>
    <li>Sync with database on click</li>
    <li>Load from database on click</li>
    <li>Show currently loaded data</li>
</ul>

<div>
    <div>
        <label for="goal_input">Test </label><input type="text" id="goal_input" name="Input goal name">
        <button onclick="newEntryClick(document.getElementById('goal_input').value)">Add new entry</button>
    </div>
    <div><button onclick="sendToDatabaseClick()">Upload to database</button></div>
    <div><button onclick="loadFromDatabaseClick()">Retrieve from database</button></div>
</div>

<div>
    <h3>Current goals</h3>
    <ul id="habits_list">
        <li>Placeholder</li>
    </ul>
</div>

<script>
    const s3BucketName = 'selfactualizationtest';

    // Setup identity pool
    AWS.config.region = 'eu-north-1'; // Region
    AWS.config.credentials = new AWS.CognitoIdentityCredentials({
        IdentityPoolId: 'eu-north-1:51a3d198-8df4-48b0-bc86-61e12f4539d9',
    });

    // Access S3 bucket using the anonymous credentials
    const s3 = new AWS.S3({
        params: {Bucket: s3BucketName}
    });

    // List the content of the bucket
    s3.listObjects(function(err, data) {
        if (err) {
            throw err;
        }
        if (data) {
            console.log(data.Contents);
            data.Contents.forEach((file) => {
                if (file.Key === "user1.json") {
                    console.log(file.Key)
                    console.log(file)
                }
            })
        }
    });

    // s3.getObject({
    //     Bucket: "",
    //     Key: "user1.json"
    // }, function(err, data) {
    //     if (err) {
    //         console.log(err, err.stack);
    //         callback(err);
    //     } else {
    //         console.log("Raw text:\n" + data.body.toString('ascii'))
    //     }
    // });

    const loadedEntries = ["Health", "Usefulness"];

    function newEntryClick(newEntry) {
        console.log("New entry clicked");
        loadedEntries.push(newEntry);
        updateHabitsDisplay();
    }

    function sendToDatabaseClick() {
        console.log("Sending to database");
    }

    function loadFromDatabaseClick() {
        console.log("Loading from database");
        updateHabitsDisplay();
    }

    // https://stackoverflow.com/questions/43376270/how-to-dynamically-populate-a-list-on-an-html-page
    function updateHabitsDisplay() {
        const listElem = document.getElementById("habits_list");
        listElem.innerHTML = "";

        loadedEntries.forEach(function(entry) {
            const newItem = document.createElement('li');
            newItem.appendChild(document.createTextNode(entry));
            listElem.appendChild(newItem);
        });
    }

    window.onload = function() {
        updateHabitsDisplay();
    }
</script>

</body>
</html>